# Archiverse Theia: Component Overview and `crossmodel` Comparison

This table provides a high-level overview of the key architectural components in the Archiverse ecosystem, focusing on where they reside (within this `archiverse-theia` repository or externally) and drawing comparisons to the `crossmodel` reference implementation (`submodules/crossmodel`).

| Component Category         | Archiverse Component Name           | Location / Repository                           | Role & Description                                                                                                                                | Naming / Location in `crossmodel` (`submodules/crossmodel`)                                    |
| :------------------------- | :---------------------------------- | :---------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------- |
| **Core Domain Logic**      | Archiverse Ontology (Langium Grammar) | `@ntrtd/archiverse-ontology` (External Repo)    | Defines the Archiverse modeling language (`*.langium`) structure, rules, and metamodel using Langium. Consumed ONLY by the model server.             | DSL Grammar (`*.langium` file, defined within `language-server` component)                     |
|                            | Core Language Services (Langium)    | `archiverse-model-server` (External Repo)       | Implements Langium services (parser, validator, linker, scope provider, AST management) based on the ontology. Provides language features via LSP. | `language-server` (`extensions/crossmodel-lang/src/language-server/`)                          |
| **Persistence**            | Persistence Layer Interface         | `archiverse-model-server` (External Repo)       | Defines the contract for how model data is saved, loaded, and queried. Abstract definition within the model server.                               | (Implicit contract within `language-server` or `model-server`)                                   |
|                            | Persistence Implementations         | `archiverse-model-server` (External Repo)       | Concrete adapters within the model server connecting to storage backends (e.g., GraphDB, in-memory). Handles data mapping.                        | (Likely integrated within `model-server`; not explicitly separate persistence packages shown)    |
| **Diagramming (GLSP)**     | GLSP Server                         | `archiverse-model-server` (External Repo)       | Backend service generating graphical models (GModels) from semantic models (AST) and handling diagram edits via GLSP protocol (WebSockets).      | `glsp-server` (`extensions/crossmodel-lang/src/glsp-server/`)                                  |
|                            | GLSP Client                         | `packages/theia-frontend-glsp` (This Repo)      | Theia frontend extension rendering diagrams received from the GLSP Server and sending user interactions back. Communicates via WebSockets.           | `glsp-client` (`packages/glsp-client`)                                                         |
| **Model Access API**       | Model Service Facade API            | `archiverse-model-server` (External Repo)       | Unified RPC API exposed by the model server for high-level model query/manipulation, abstracting Langium and persistence details.                    | `ModelServiceFacade` / `Model Server` (`extensions/crossmodel-lang/src/model-server/`)         |
| **Theia Integration**      | Theia Backend Contributions         | `packages/theia-backend-extensions` (This Repo) | Run in Theia backend process. Act as **proxies/clients** to the external `archiverse-model-server`. Handles RPC, LSP proxying, GLSP proxying.          | Backend Contributions (e.g., in `packages/core`) acting as clients to internal server process. |
|                            | Theia Frontend Extensions           | `packages/theia-frontend-*` (This Repo)       | UI components (explorer, forms, GLSP client, etc.) running in Theia frontend. Communicate with Backend Contributions via Theia RPC.             | Frontend Extensions (e.g., `packages/form-client`, `glsp-client`)                              |
|                            | RPC Protocol Definition             | `packages/protocol` (This Repo)                 | Defines the custom RPC contract (interfaces, types) between Theia Backend Contributions and the external `archiverse-model-server` API.          | Custom RPC definitions (potentially within `model-server` or shared location)                  |
| **Application Host**       | Theia Electron/Browser App          | `hosts/*` (This Repo)                           | Assembles and runs the Theia frontend and backend extensions, providing the executable IDE/tool (Desktop or Web).                            | `applications/electron-app`, `applications/browser-app`                                        |
| **Deployment/Infra**       | Kubernetes Operator & CRDs          | `archiverse-infra` (External Repo)            | Manages dynamic per-user session creation, configuration (incl. service URLs), and teardown in Kubernetes (based on Theia Cloud).                   | N/A (`crossmodel` focuses on local execution via VS Code extension)                            |
|                            | Helm Charts / Kustomize             | `archiverse-infra` (External Repo)            | Define deployment configurations for Kubernetes environments.                                                                                  | N/A                                                                                              |
| **External Dependencies**  | Graph Database (if used)            | External Infrastructure                         | The actual database system (e.g., JanusGraph/TinkerPop) used by the `archiverse-model-server`'s persistence layer.                             | N/A (Not shown in `crossmodel` structure)                                                      |

**Architectural Notes & `crossmodel` Comparison:**

*   **Process Separation:** Both Archiverse and `crossmodel` separate the core domain logic (Langium, GLSP, Model Service API) into a dedicated server process, distinct from the main Theia Backend process that hosts integration extensions. This is a fundamental similarity.
    *   **Archiverse:** The server process (`archiverse-model-server`) is fully external (separate repository, independent deployment).
    *   **`crossmodel`:** The server process is managed internally via a VS Code extension (`submodules/crossmodel/extensions/crossmodel-lang/`), suitable for local/desktop use but requires refactoring for cloud deployment.
*   **Communication:**
    *   **Frontend <-> Theia Backend:** Both use standard Theia RPC.
    *   **Theia Backend <-> Core Logic Server:**
        *   **Archiverse:** Theia backend extensions use custom RPC (`packages/protocol`) to the external `archiverse-model-server`'s Model Service API. Standard LSP and GLSP protocols are also used (likely proxied).
        *   **`crossmodel`:** Theia backend extensions use LSP, GLSP protocol, and Custom RPC to communicate with its *internal* server process.
*   **Grammar Location:** Archiverse defines its grammar externally (`@ntrtd/archiverse-ontology`), while `crossmodel` includes its grammar definition within its monorepo.
*   **Persistence:** Archiverse centralizes persistence logic within the external `archiverse-model-server`. `crossmodel` integrates it more directly within its internal server process components.
*   **Deployment:** Archiverse's external server model is inherently designed for cloud/Kubernetes deployment (managed via `archiverse-infra`), potentially using an Operator pattern for multi-tenancy. `crossmodel`'s primary deployment model demonstrated is local execution via its VS Code extension.

This component structure emphasizes modularity and facilitates independent scaling and deployment, leveraging patterns common in complex Theia-based modeling tools, as seen in both Archiverse and the `crossmodel` reference.
